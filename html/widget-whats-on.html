<html>
<head>
  <title>Whats on widget (v2.4)</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<script type="application/javascript" src="../js/modernizr-custom.js"></script>  <!--development build to catch unsupported functionality in browsers -->

<!-- Frameworks styles-->
<script type="text/javascript" src="../js/packery.pkgd.min.js"></script>
<link rel="stylesheet" href="../css/bootstrap.css">
<link rel="stylesheet" href="../css/bootstrap-theme.css">
<script type="text/javascript" src="../js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../js/flickity.pkgd.js"></script>
<script type="text/javascript" src="../js/instafeed.min.js"></script>
<script type="text/javascript" src="../js/progressbar.js"></script>
<script src="../js/respond.min.1.4.2.js"></script> <!-- loads respond JS for old browser support for media queries -->

<!-- Widgets and Flickity  styles-->
<link rel="stylesheet" href="../css/widget-whats-on.css">
<link rel="stylesheet" href="../css/flickity.min.css" media="screen">

<!-- Main Prototype styles -->
<link rel="stylesheet" href="../css/prototype-base.css">
<!--<link rel="stylesheet" href="../css/just-grids.css">-->

<style type="text/css">
    
   /* Just grid css styles */
    
    .grid-item {
      padding: 5px;
    }

    .grid-content {
/*
        padding: 15px 30px 15px 0;
        background: #fff;
*/
    }
    
    /* Flickity inline styles */
    .main-gallery {
        overflow: hidden;
    }
    .gallery-cell {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 285px;
    }    
    #sow {
        background-image: url('../img/whats-on/a-state-of-war.jpg');
        background-size: cover;
        background-repeat: no-repeat;
    }
    #iconic {
        background-image: url('../img/whats-on/iconic-qld.jpg');
        background-size: cover;
        background-repeat: no-repeat;
    }
    #uqarch {
        background-image: url('../img/whats-on/UQ_architecture.jpg');
        background-size: cover;
        background-repeat: no-repeat;
    }
    #qrf {
        background-image: url('../img/whats-on/qm-awards.jpg');
        background-size: cover;
        background-repeat: no-repeat;
    }
    #bw {
        background-image: url('../img/whats-on/black-and-write.jpg');
        background-size: cover;
        background-repeat: no-repeat;
    }
    #qldfaces {
        background-image: url('../img/whats-on/queenslandfaces.jpg');
        background-size: cover;
        background-repeat: no-repeat;
    }
</style>

</head>
    
<body>
<div class="container">
  
<a class="slq-logo"><img src="../img/Prototype%20device.svg" /></a>
    <img src="../img/Prototype%20header.svg" width="100%" />
  
   <div class="grid"> 
       <div class="grid-item col-xs-12 col-sm-6 col-md-8">
           <div class="grid-content">
               <div class="main-gallery">
                    <div class="gallery-cell">
                        <div id="sow">
                            <h3><a href="http://qanzac100.slq.qld.gov.au/showcase/a-state-of-war">A State of War</a></h3>
                            <p>Interactive display at SLQ. To ensure the recommendations are implemented effectively, the Hunter Review Report Action Plan is being run as a significant project using Prince2 methodology.</p>
                        </div>
                    </div>
                    <div class="gallery-cell">
                        <div id="iconic">
                            <h3><a href="http://www.slq.qld.gov.au/showcase/the-william-jolly-bridge">Iconic Queensland</a></h3>
                            <p>Legacy of Sir Manuel Hornibrook</p>
                        </div>
                    </div>
                    <div class="gallery-cell">
                        <div id="uqarch">
                            <h3><a href="http://www.slq.qld.gov.au/whats-on/calevents/general/talks/apdl/uq-architecture-lecture-series-2016">UQ Architecture Lecture Series</a></h3>
                            <p>Free weekly lectures | 1 Mar - 26 Apr</p>
                        </div>
                    </div>
                    <div class="gallery-cell">
                        <div id="qrf">
                            <h2><a href="http://www.slq.qld.gov.au/whats-on/awards/qmawards">Queensland Research Fellowships</a></h2>
                            <p>Lorem ipsum dolor, <a href="#">apply now.</a></p>
                        </div>
                    </div>
                    <div class="gallery-cell">
                        <div id="bw">
                            <h2><a href="http://www.slq.qld.gov.au/whats-on/awards/blackwrite/fellowships">black&amp;write!</a></h2>
                            <p>Indigenous Writing Fellowships | Applications close Fri 26 Feb</p> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="grid-item col-xs-12 col-sm-6 col-md-4">
          <div class="grid-content">
            <h3><img src="../img/time-icon.svg" class="clock tile-title-icon" />Opening hours</h3>
            <p class="text-lge">Mon-Thu <strong>10am - 8pm</strong><br />
              Fri-Sun <strong>10am - 5pm</strong></p>
            <p id="countdown"></p>
            <p><a href="#">Special areas &amp; public holidays</a></p>
          </div>
        </div>
        
        <div class="grid-item col-xs-12 col-sm-6 col-md-4">
          <div class="grid-content">
            <h3>kuril dhagun</h3>
            <p>Located on Level 1 of our South Bank building, kuril dhagun is an indigenous space.</p>
            <ul>
              <li><a href="#">Lilla Watson artwork</a></li>
              <li><a href="#">Possum skin cloak workshops</a></li>
              <li><a href="#">Talking circle</a></li>
            </ul>
            <p class="aRight"><a href="#">Read more...</a></p>
          </div>
        </div>
        
        <div class="grid-item col-xs-12 col-sm-6 col-md-4">
          <div class="grid-content social">
              <div id="instafeed"> 
              </div>
          </div>
        </div>
        
        <div class="grid-item col-xs-12 col-sm-6 col-md-4">
          <div class="grid-content">
            <h3>QLF campaign</h3>
            <ul class="progressBar">
              <li class='donations' data-width='60' data-target='100'>Funding</li>
            </ul>
            <p>All donations received by QLF between 2 February and 29 May 2016 to support SLQ will be matched by Creative Partnerships Australia once the total fundraising target is achieved.</p>
          </div>
        </div>
        
    </div>
</div>

<script type="text/javascript">
    
function ShowTime() {

	//access system clock and get the time
	var aest = new Date();
	var localTime = aest.getTime();
	
	//obtain local UTC offset and convert to msec
	var localOffset = aest.getTimezoneOffset()*60000;
	
	//Get total UTC time in msec
	var utc = localTime + localOffset;
	//obtain and add destination UTC time offset (Brisbane, Australia +10)
	var offset = 10;
	var brisbane = utc + (3600000*offset);
	var brisDay = new Date(brisbane);
	var brisDay = brisDay.getDay();
	//Set weekend days with different opening hours
	//Set numbers representing weekend days - 0 for Sunday, 6 for Saturday
	if (brisDay==0 || brisDay==5 || brisDay==6) {
		hoursBase = 16;
		hoursBefore = 6
	}
	else {
		hoursBase = 19;
		hoursBefore = 9
	}
	
	//convert msec value (with timezone offset) to datetime string variables
	consTime = new Date(brisbane);
	var brisHours = hoursBase-consTime.getHours();
	var brisMinutes = 60-consTime.getMinutes();
	var brisSec = 60-consTime.getSeconds();
	
	//complete string for offset AEST local time
	//show CLOSED message if past closing time
	if (brisHours<0 || brisHours>hoursBefore) {
	var timeLeft = "<strong>The SLQ building is currently closed.</strong>";
        //currently set the first if/else statement to trigger after 12pm for testing. SVG line doesn't want to repeat-x when using inline.
    } else if (brisHours<3 || brisHours>hoursBefore) {
        var timeLeft = "SLQ will be open for another<br /><strong style='background-image:url(../img/wavy-underline2.svg);background-repeat:repeat-x;background-position:left 15px;background-size:10px 13px'>" +brisHours+' hrs '+brisMinutes+' min '+brisSec+' sec'+ "</strong> today";
    } else if (brisHours<2 || brisHours>hoursBefore) {
        var timeLeft = "SLQ will be open for another<br /><strong style='background-image:url(../img/wavy-underline3.svg);background-repeat:repeat-x;background-position:left 15px;background-size:10px 13px'>" +brisHours+' hrs '+brisMinutes+' min '+brisSec+' sec'+ "</strong> today";
    } else if (brisHours<1 || brisHours>hoursBefore) {
        var timeLeft = "SLQ will be open for another<br /><strong style='background-image:url(../img/wavy-underline4.svg);background-repeat:repeat-x;background-position:left bottom'>" +brisHours+' hrs '+brisMinutes+' min '+brisSec+' sec'+ "</strong> today";
	}
        else {
	var timeLeft = "SLQ will be open for another<br /><strong>" +brisHours+' hrs '+brisMinutes+' min '+brisSec+' sec'+ "</strong> today";
	//var timeLeft = brisHours+' hrs '+brisMinutes+' min '+brisSec+' sec';
	}
	
	//output adjusted time into page
    document.getElementById("countdown").innerHTML = timeLeft;
}

//Setup variable to update on setInterval function every 1000 ticks
var countdown = setInterval(ShowTime ,1000);
    
    // initialise the flickity sliders on page with jQuery
    $('.main-gallery').flickity({
      // options
      cellAlign: 'left',
      contain: true,
      autoPlay: 2000,
      prevNextButtons: false,
      pageDots: false,
      wrapAround: true
    });
    
    // initialise the page in packery layout with vanilla js
    var elem = document.querySelector('.grid');
    var pckry = new Packery( elem, {
      // options
      itemSelector: '.grid-item',
      gutter: 0,
      columnWidth: 0,
      rowHeight: 0,
      isOriginTop: true,
      isHorizontal: false,
      percentPosition: true,
      stamp: '.stamp',
    });
    
    // Social media buttons widget with background image generated by SLQ Instagram feed (most recent uploaded image)
    // Get the most latest instagram post and insert it into the page in the DIV# instafeed (within "a" element)
    // Instagram feed is currently connected to and referencing Coolwebs Instagram account (ownder is RA)
    var feed = new Instafeed({
        get: 'user',
        userId: '249842490',
        accessToken: '249842490.1677ed0.0283e662751a4e369ae856f60a4b6228',
        sortBy: 'most-recent',
        resolution: 'low_resolution',
        limit: 1,
        clientId: 'dee7958de6a64ed284b95abb1619b790',
        template: '<div class="insta-image" style="background-image: url({{image}});background-size: cover;height:285px;"><div class="social-buttons"> <table> <tr> <td><img src="../img/social/iconmonstr-twitter-4-icon.svg" class="social-icon"/></td><td><img src="../img/social/iconmonstr-facebook-4-icon.svg" class="social-icon"/></td><td><img src="../img/social/iconmonstr-instagram-9-icon.svg" class="social-icon active-social-data"/></td></tr><tr> <td><img src="../img/social/iconmonstr-pinterest-1.svg" class="social-icon"/></td><td><img src="../img/social/iconmonstr-vimeo-4-icon.svg" class="social-icon"/></td><td><img src="../img/social/iconmonstr-youtube-4-icon.svg" class="social-icon"/></td></tr><tr> <td><img src="../img/social/iconmonstr-map-icon.svg" class="social-icon"/></td><td><img src="../img/social/iconmonstr-layer-6-icon.svg" class="social-icon"/></td><td><img src="../img/social/iconmonstr-light-bulb-3-icon.svg" class="social-icon"/></td></tr></table> </div></div>'
        //make this content above into a JS variable. Looks real nasty inserted straight into the function.
    });
feed.run();
    
    // attach progress bar animation to object
    //Credits to http://www.jqueryscript.net/loading/Custom-Viewport-Based-jQuery-Progress-Bar-Plugin-Progressbar-js.html

    $('.donations').progressBar({
          height : "30",
          backgroundColor : "#E0E0E0",
          shadow : false,
          percentage : true,
          border : false,
          animation : true,
          animateTarget : true,
          barColor : "black",
     });
    
// jQuery toggle for other sites buttons
// RA 2016/06/10 changed the function so that clickable area is isolated and uses ASCCI toggle characters, not bg images
  $(document).ready(function($) {
    $('.otherSites').find('.accordion-toggle span').click(function(){

      //Expand or collapse this panel
      $(this.parentNode).next().slideToggle('fast');

        // Determine if it's open or closed
        var toggleState = $(this).html();
        if (toggleState=="+") {
            $(this).html("-");
        } else if (toggleState=="-") {
            $(this).html("+")
        }

      //Hide the other panels
      $(".accordion-content").not($(this.parentNode).next()).slideUp('fast');

        //Find change the icon of any open panels back to closed
        if($('.otherSites').find('.accordion-content span').html("-")){
            console.log("make all other toggles go to +");
            $(".toggleIcon").not($(this)).html("+")
        }
    });
  });
</script>
<!--<script type="text/javascript" src="../js/functions-base.js"></script>-->
</body>
</html>